# 同期クイズアプリ - マルチプレイヤー機能

このアプリに同期的なマルチプレイヤー機能を追加しました。親ホストがゲームを開始すると、全員が同時にクイズを始めることができます。

## ✅ 実装済み機能

### 🎮 完全同期型ゲームフロー
1. **待機室**: 全員の準備完了を確認
2. **説明画面 (15秒)**: ゲームルールとカウントダウン
3. **サンプルクイズ (2問×10秒)**: 練習用クイズ
4. **本番準備画面 (10秒)**: 「次が本番です」メッセージ
5. **本番クイズ (5問×20秒)**: メインのクイズ
6. **結果画面**: 最終スコアとランキング

### 🔄 リアルタイム同期機能
- **完全同期**: 全プレイヤーが常に同じ画面を表示
- **状態管理**: サーバーが全体の進行を制御
- **タイマー同期**: 全員が同じカウントダウンを見る
- **デバッグログ**: 各フェーズの遷移をコンソールで確認可能

### 📊 正解者数の表示
- 各問題の正解発表時に正解した人数を表示
- 表示形式: `🎯 正解者: X / Y人`

### 🎯 マルチプレイヤーモード
- **ルーム作成**: ホストがルームを作成し、他のプレイヤーを招待
- **ルーム参加**: ルームコードを使って他のプレイヤーが参加
- **同期開始**: ホストがスタートすると全員同時にクイズ開始
- **リアルタイム**: 全プレイヤーの進行状況をリアルタイムで同期

### 📱 画面構成
1. **ログイン画面**: シングルプレイ or マルチプレイヤーを選択
2. **ルーム画面**: ルーム作成 or 参加
3. **待機室**: プレイヤー一覧と準備状態の確認
4. **同期クイズ画面**: 全員同時進行のクイズ
5. **結果画面**: 最終スコアとランキング

## セットアップ

### 1. サーバーの起動

```bash
# サーバーディレクトリに移動
cd server

# 依存関係をインストール
npm install

# サーバーを起動
npm start
```

### 2. アプリの起動

```bash
# メインディレクトリで
npm start
```

## 使用方法

### ホスト（親）の操作
1. ログイン画面で「マルチプレイヤー」を選択
2. 「ルームを作成」をクリック
3. 生成されたルームコードを他のプレイヤーに共有
4. 待機室で全員の準備完了を確認
5. 「ゲーム開始」でクイズスタート

### プレイヤー（子）の操作
1. ログイン画面で「マルチプレイヤー」を選択
2. ホストから受け取ったルームコードを入力
3. 「ルームに参加」をクリック
4. 待機室で「準備する」をクリック
5. ホストの開始を待機

## 技術仕様

### WebSocket通信
- **サーバー**: Node.js + ws ライブラリ
- **クライアント**: ブラウザ標準のWebSocket API
- **ポート**: 3001（デフォルト）

### メッセージタイプ
- `join`: ルーム参加
- `playerReady`: プレイヤー準備完了
- `startGame`: ゲーム開始
- `submitAnswer`: 回答送信
- `questionEnd`: 問題終了・結果表示
- `gameEnd`: ゲーム終了

### 同期制御
- **問題開始**: ホストの指示で全員同時開始
- **制限時間**: 各問題20秒（全員共通）
- **結果表示**: 20秒経過後に一斉表示
- **次問題**: 3秒後に自動的に次の問題へ

## ファイル構成

```
src/
├── context/
│   └── GameContext.js          # ゲーム状態管理
├── screens/
│   ├── RoomScreen.js           # ルーム作成・参加画面
│   ├── WaitingRoomScreen.js    # 待機室画面
│   └── SyncQuizScreen.js       # 同期クイズ画面
server/
├── websocket-server.js         # WebSocketサーバー
└── package.json               # サーバー依存関係
```

## 注意事項

### 開発環境での制限
- WebSocketサーバーは `localhost:3001` で動作
- 実際のデプロイ時は適切なサーバーURLに変更が必要
- ネットワーク環境によってはWebSocket接続が制限される場合があります

### フォールバック機能
- WebSocket接続に失敗した場合、自動的にシングルプレイモードで動作
- サーバーが利用できない環境でも基本機能は使用可能

## カスタマイズ

### 問題数の変更
`src/data/quizData.js` で問題を追加・変更できます。

### 制限時間の調整
各画面の `timeLeft` 初期値と `setTimeout` の値を変更してください。

### スタイルの変更
各画面の `StyleSheet` でデザインをカスタマイズできます。

## トラブルシューティング

### WebSocket接続エラー
1. サーバーが起動しているか確認
2. ポート3001が使用可能か確認
3. ファイアウォール設定を確認

### 同期がずれる場合
1. ネットワーク遅延が原因の可能性
2. サーバーログで接続状況を確認
3. ブラウザの開発者ツールでWebSocketメッセージを確認

これで同期的なマルチプレイヤークイズアプリが完成しました！ホストが開始すると全員が同時にクイズを始められます。